<dom-module id="my-cart-page">
		<link rel="import" href="/custom_components/cart_card.html">
  <template>
    <!-- Materialize -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>

    <!-- Our CSS and JS -->
    <link href="../mystyle.css" rel="stylesheet">
    <style>
      .card-content {
        min-height: 160px;
      }
      .card-image {
        height: 400px;
        overflow: hidden;
      }
      .card-image img {
        height: auto;
        width: 100%;
        /*object-fit: contain;*/
      }
    </style>

    <main class="container">
      <section class="row">
					<div class="container">
							<div id="cart_itens"></div>
					</div>
      </section>
    </main>
	</template>
  <script>
		function new_card() {
				const card = $("<cart-card>", {class: 'card'});
		}
    Polymer({
      is: 'my-cart-page',
      ready: function () {
					const cart_itens = $(this.$.cart_itens);
					const itens_in_cart = Cookies.getJSON('cart');
					const itens_in_cart_ids = []
					console.log('using cookies ', JSON.stringify(itens_in_cart));
					for (const item in itens_in_cart) {
							itens_in_cart_ids.push(item);
					}
					console.log('using items: ', JSON.stringify(itens_in_cart_ids));
					if (itens_in_cart_ids.length == 0) itens_in_cart_ids.push('');
					const query_string = '?id=' + itens_in_cart_ids.reduce((str, i) => {
							return str + '&id=' + i;
					});
					console.log('query: ', query_string);
					$.get(serverURL + 'products' + query_string, (result, status) => {
							for (const [i, product] of result.entries()) {
									const card = $('<cart-card>').addClass('row col s12');
									card.prop('_id', product._id);
									card.prop('description', product.description);
									card.prop('name', product.name);
									card.prop('price', product.price);
									card.prop('stock', product.stock);
									card.prop('picture', product.picture);
									card.prop('quantity', product.quantity);
									card.prop('amount', itens_in_cart[product._id]);
									card.prop('serverURL', serverURL);
									cart_itens.append(card);
							}
					});
      }
    });
  </script>
</dom-module>
