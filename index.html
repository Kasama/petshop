<!DOCTYPE html>

<html>

<head>
	<meta charset="utf-8">
	<title>PetShop Animal</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<!-- JQuery -->
	<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="/bower_components/js-cookie/src/js.cookie.js"></script>

	<!-- Materialize -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>

	<!--Polymer-->
	<script type="text/javascript" src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
	<link rel="import" href="/../bower_components/polymer/polymer.html">
	<link rel="import" href="/../custom_components/footer.html">
	<link rel="import" href="/../custom_components/header.html">

	<!-- Our CSS and JS -->
	<link rel="stylesheet" href="../mystyle.css">

	<!-- Pages -->
	<link rel="import" href="/init_page.html">
	<link rel="import" href="/login.html">
	<link rel="import" href="/about.html">
	<link rel="import" href="/admin.html">
	<link rel="import" href="/register/register_admin.html">
	<link rel="import" href="/register/register_client.html">
	<link rel="import" href="/register/register_pet.html">
	<link rel="import" href="/register/register_product.html">
	<link rel="import" href="/register/register_service.html">
	<link rel="import" href="/manage/manage_pets.html">
	<link rel="import" href="/manage/manage_services.html">
	<link rel="import" href="/detail/detail_product.html">
	<link rel="import" href="/detail/detail_pet.html">
	<link rel="import" href="/detail/detail_service.html">
</head>

<script type="text/javascript">
	function createElement(tag, attributes){
		let elem = document.createElement(tag)
    	elem.id = "main_element";
    	
    	if(!attributes){
	    	for(att in attributes){
	    		elem[att.name] = att.value;
	    	}
    	}

    	return elem;
	}

	function changeMainElement(tag, attributes = null, addToHistory = true){
		console.log("loading " + tag);
		$("#main_element").remove();
    	
		let page_description = {tag:tag, attributes:attributes}

		Cookies.set("current-page-description", page_description, { expires: 1 });

		let elem = createElement(tag, attributes);
    	document.getElementById("main").appendChild(elem);

    	if(addToHistory){
    		history.pushState(page_description, null, "/" + tag);
    	}
	}
	
	function doLogin(user_id){
		Cookies.set("user-id", event.detail.data.user_id);
		
		$('#login_page_button').toggle();
		$('#register_page_button').toggle();
		$('#user_home_page_button').toggle();
		$('#logout_button').toggle();
		//$('#search').attr("size", 52);
		
		$('#login_page_side_button').toggle();
		$('#register_page_side_button').toggle();
		$('#user_home_page_side_button').toggle();
		$('#logout_side_button').toggle();
		
		//ideally this would go to the user's homepage
		//we don't have one yet, so it sends to the main
		// TODO: send to user's homepage
		changeMainElement("init-page");
	}
	
	function doLogout(){
		Cookies.set("user-id", "");
		
		$('#login_page_button').toggle();
		$('#register_page_button').toggle();
		$('#user_home_page_button').toggle();
		$('#logout_button').toggle();
		
		$('#login_page_side_button').toggle();
		$('#register_page_side_button').toggle();
		$('#user_home_page_side_button').toggle();
		$('#logout_side_button').toggle();
		
		changeMainElement("init-page");
	}
	
	(function($){
		$(function(){
			$('.button-collapse').sideNav();
			$('#user_home_page_button').hide();
			$('#logout_button').hide();
			$('#user_home_page_side_button').hide();
			$('#logout_side_button').hide();
			
			document.addEventListener('iron-signal', event => {
				if(event.detail.name === "change-signal"){
		       		changeMainElement( event.detail.tag, event.detail.data );
		   		}else if(event.detail.name === "set-variable-value"){
		   			// will it be used?
		   		}else if(event.detail.name === "get-variable-value"){
		   			// will it be used?
		   		}else if(event.detail.name === "do-login"){
		   			doLogin(event.detail.data.user_id);
		   			
		   		}
		    });

		    $('.page-changing-button').click((e) => {
		    	changeMainElement($(e.target).data("target"));
		    	return false;
		    })

		    window.addEventListener("popstate", function(e) {
				console.log(e.state);
				changeMainElement(e.state.tag.replace("#", ""), e.state.attributes, false);
			});
		    /*
		    let curr_page = Cookies.getJSON("current-page-description");
		    if(curr_page && curr_page.tag){
		    	changeMainElement(curr_page.tag.replace("#", ""), curr_page.attributes);
		    }
		    */
		});
	})(jQuery);

</script>

<body>
	<header>
		<nav class="light-red" role="navigation">
			<div class="nav-wrapper container">
				<a data-target="init-page" id="logo-container" class="brand-logo page-changing-button" href="#">PetShop Animal</a>
				<ul id="header_inner_container" class="right hide-on-med-and-down">
					<li>
						<input id="search" type="search" size=40 placeholder="Pesquisa" />
					</li>
					<li id="login_page_button"><a class="page-changing-button" data-target="login-page">Login</a></li>
					<li id="register_page_button"><a class="page-changing-button" data-target="register-client-page">Registrar</a></li>
					<li id="user_home_page_button"><a class="page-changing-button" data-target="init-page">Home</a></li>
					<li id="logout_button"><a onclick="doLogout()">Logout</a></li>
					<li id="about_page_button"><a class="page-changing-button" data-target="about-page">Sobre</a></li>
				</ul>

				<ul id="nav-mobile" class="side-nav" style="transform:translateX(-100%);">
					<li>
						<input id="search-hidden" type="search" placeholder="Pesquisa" />
					</li>
					<li id="login_page_side_button"><a class="page-changing-button" data-target="login-page">Login</a></li>
					<li id="register_page_side_button"><a class="page-changing-button" data-target="register-client-page">Registrar</a></li>
					<li id="user_home_page_side_button"><a class="page-changing-button" data-target="init-page">Home</a></li>
					<li id="logout_side_button"><a onclick="doLogout()">Logout</a></li>
					<li id="about_page_side_button"><a class="page-changing-button" data-target="about-page">Sobre</a></li>
				</ul>
				<a href="#" data-activates="nav-mobile" class="button-collapse">
					<i class="material-icons">menu</i>
				</a>
			</div>
		</nav>
	</header>

	<main id="main">
		<manage-service-page id="main_element"/>
	</main>

	<footer>
		<store-footer></store-footer>
	</footer>
</body>

</html>